<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title><%= post.title %> | Blog</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background-color: #f4f6f9;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  .post-container {
    max-width: 850px;
    margin: 40px auto;
    background: #fff;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.08);
  }

  /* Back Button */
  .back-btn {
    display: inline-block;
    background-color: #4b00ff;
    color: white;
    padding: 6px 16px;
    border-radius: 8px;
    font-weight: 500;
    text-decoration: none;
    transition: 0.3s;
    margin-bottom: 15px;
  }

  .back-btn:hover {
    background-color: #3200b8;
    color: #fff;
  }

  /* Post Title & Meta */
  .post-title {
    font-weight: 700;
    font-size: 2rem;
    margin-bottom: 6px;
    color: #222;
  }
  .post-meta {
    font-size: 0.95rem;
    color: #6c757d;
    margin-bottom: 18px;
  }

  /* Post Image */
  .post-img {
    width: 100%;
    max-height: 420px;
    object-fit: cover;
    border-radius: 14px;
    margin-bottom: 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.2);
  }

  /* Post Body */
  .post-body {
    font-size: 1.1rem;
    line-height: 1.75;
    color: #333;
    margin-bottom: 28px;
  }

  /* Buttons */
  .like-btn {
    background-color: #ff4b5c;
    color: white;
    padding: 6px 16px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    transition: 0.3s;
  }
  .like-btn:hover {
    background-color: #e84118;
    transform: translateY(-2px);
  }

  .edit-btn {
    background-color: #00a8ff;
    color: white;
  }
  .edit-btn:hover {
    background-color: #008ed6;
  }
  .delete-btn {
    background-color: #ff4757;
    color: white;
  }
  .delete-btn:hover {
    background-color: #e84118;
  }
  .action-btn {
    border: none;
    border-radius: 8px;
    padding: 6px 14px;
    font-weight: 600;
    margin-left: 10px;
    transition: 0.3s;
  }

  /* Comments */
  .comments-section {
    margin-top: 40px;
  }
  .comment-card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 14px 18px;
    margin-bottom: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  .comment-author {
    font-weight: 600;
    color: #4b00ff;
  }
  .comment-body {
    margin: 6px 0;
    color: #333;
  }
  .comment-date {
    font-size: 0.8rem;
    color: #777;
  }

  .comment-form textarea {
    border-radius: 10px;
    resize: vertical;
  }
</style>
</head>
<body>
<%- include('../../partials/header') %>

<main class="container">
  <div class="post-container">

    <!-- Back Button -->
    <a href="/blog" class="back-btn">‚Üê Back</a>

    <!-- Title & Meta -->
    <h1 class="post-title"><%= post.title %></h1>
    <div class="post-meta">
      by <%= post.author ? post.author.username : "Unknown Author" %>
    </div>

    <!-- Image -->
    <% if (post.coverUrl) { %>
      <img class="post-img" src="<%= post.coverUrl %>" alt="">
    <% } %>

    <!-- Post Body -->
    <div class="post-body">
      <%= post.body %>
    </div>

    <!-- Like + Edit + Delete -->
    <div class="d-flex align-items-center mb-4">
      <form method="POST" action="/posts/<%= post._id %>/like">
        <button class="like-btn">
          ‚ù§Ô∏è Like (<%= post.likes.length %>)
        </button>
      </form>

      <% if (user && post.author && String(user._id) === String(post.author._id)) { %>
        <a href="/posts/edit/<%= post._id %>" class="action-btn edit-btn">‚úèÔ∏è Edit</a>
        <form action="/posts/delete/<%= post._id %>" method="POST" class="d-inline">
          <button type="submit" class="action-btn delete-btn" onclick="return confirm('Are you sure?')">
            üóëÔ∏è Delete
          </button>
        </form>
      <% } %>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
      <h4 class="fw-bold mb-3">üí¨ Comments</h4>

      <!-- Comment Form -->
      <form method="POST" action="/posts/<%= post._id %>/comments" class="comment-form mb-4">
        <textarea class="form-control mb-2" name="body" required rows="3" placeholder="Write your comment..."></textarea>
        <button class="btn btn-dark btn-sm">Post Comment</button>
      </form>

      <!-- Comment List -->
      <% if (post.comments.length > 0) { %>
        <% post.comments.slice().reverse().forEach(c => { %>
          <div class="comment-card">
            <div class="comment-author"><%= c.author?.username || 'User' %></div>
            <div class="comment-body"><%= c.body %></div>
            <div class="comment-date"><%= new Date(c.createdAt).toLocaleString() %></div>
          </div>
        <% }) %>
      <% } else { %>
        <p class="text-muted">No comments yet. Be the first to comment!</p>
      <% } %>
    </div>
  </div>
</main>

<%- include('../../partials/footer') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
